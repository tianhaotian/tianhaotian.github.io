<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="blogs">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="blogs">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="blogs">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>blogs</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">blogs</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">frodle's blogs</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/11/java集合/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frodle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/11/java集合/" itemprop="url">java集合</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-11T22:46:58+08:00">
                2020-06-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/06/11/java集合/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/06/11/java集合/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="java中的collection"><a href="#java中的collection" class="headerlink" title="java中的collection"></a>java中的collection</h2><h3 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h3><p>一些重要的点</p>
<p>jdk1.7前，数组+链表，链表使用头插法</p>
<p>jdk1.8，数组+链表/红黑树，链表使用尾插法</p>
<p>采用尾插法的原因在于写入导致resize时，头插法会反转列表，而hashmap又是线程不安全的，所以两次resize导致链表有环从而产生异常的数据丢失</p>
<p>负载因子默认0.75，初始大小默认16</p>
<p>jdk1.8 hashmap会有单链表和红黑树的转换，默认单链表达到大于8的长度，且容量大于64时会转换为红黑树，红黑树节点小于6时会转换成单链表</p>
<p>转换的过程中单链表先转换成双向链表，再转换成红黑树，原因则是双向链表便于再转换回单链表</p>
<p>红黑树的特点，查询O(logn)，节点非黑即红，根节点是黑色，叶子节点为nil也是黑色，每个红色节点的子节点都是黑色，任意节点到其每个叶子节点的路径包含数量相同的黑节点</p>
<p>红黑树的插入，自下而上（AVL正好相反），插入是个自平衡的过程，插入节点始终是红色，因为红色可能不需要做旋转和变色的操作，若其父节点为红时，才需要变色，自下而上变色直到平衡，若变色完后不平衡，则需要对根节点进行左右旋转</p>
<p>删除思路：使用子节点代替父节点做删除（大于父节点的最小值），若不存在大于关系，则直接子节点替换</p>
<p>常见面试题：</p>
<p>HashMap的底层数据结构？<br>数组+链表/红黑树</p>
<p>HashMap的存取原理？<br>根据hash计算数组下标，链表或红黑树处理hash冲突</p>
<p>Java7和Java8的区别？<br>上面有</p>
<p>为啥会线程不安全？<br>多线程访问时，put和get无法保证数据统一（没有加锁）</p>
<p>有什么线程安全的类代替么?<br>HashTable ConcurrentHashMap</p>
<p>默认初始化大小是多少？为啥是这么多？为啥大小都是2的幂？<br>16，因为实际求余的操作可以转化为二进制的位运算，如果是2的幂，则位运算只是一个去掉二进制高位的操作，如果hash函数是分布均匀的，则位运算得到的index也是分布均匀的</p>
<p>HashMap的扩容方式？负载因子是多少？为什是这么多？<br>计算当前容量是否大于 hashmap的size*负载因子，如果满足条件，则触发扩容两倍的resize，会重新计算hash，负载因子是0.75，因为过大会导致hash冲突的密集，get效率下降，过小会浪费内存空间，根据数学分布计算得到默认0.75</p>
<p>HashMap的主要参数都有哪些？<br>初始大小，最大容量，负载因子，链表转换红黑树阈值，红黑树转链表阈值，进行红黑树转换的大小阈值</p>
<p>HashMap是怎么处理hash碰撞的？<br>链表/红黑树的方式，区别是链表查找的时间复杂度是On，而红黑树是O(logn)</p>
<p>hash的计算规则？<br>hash值和右移16位再异或，为了使hash更均匀</p>
<p>默认初始化大小16是2的幂，8也是，32也是，为啥偏偏选了16？</p>
<p>我觉得就是一个经验值，定义16没有很特别的原因，只要是2次幂，其实用 8 和 32 都差不多。</p>
<p>用16只是因为作者认为16这个初始容量是能符合常用而已。</p>
<p>Hashmap中的链表大小超过八个时会自动转化为红黑树，当删除小于六时重新变为链表，为啥呢？</p>
<p>根据泊松分布，在负载因子默认为0.75的时候，单个hash槽内元素个数为8的概率小于百万分之一，所以将7作为一个分水岭，等于7的时候不转换，大于等于8的时候才进行转换，小于等于6的时候就化为链表。</p>
<h3 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h3><p>线程安全的几种选择<br>使用Collections.synchronizedMap(Map)创建线程安全的map集合；<br>Hashtable<br>ConcurrentHashMap</p>
<p>前两者并发性能不强，常用ConcurrentHashMap</p>
<p>jdk1.7前，由 Segment 数组、HashEntry 组成，和 HashMap 一样，仍然是数组加链表。HashEntry跟HashMap差不多的，但是不同点是，使用volatile去修饰了数据Value还有下一个节点next。</p>
<p>ConcurrentHashMap 采用了分段锁技术，其中 Segment 继承于 ReentrantLock。</p>
<p>不会像 HashTable 那样不管是 put 还是 get 操作都需要做同步处理，理论上 ConcurrentHashMap 支持 CurrencyLevel (Segment 数组数量)的线程并发。</p>
<p>每当一个线程占用锁访问一个 Segment 时，不会影响到其他的 Segment。</p>
<p>put逻辑，先定位到Segment</p>
<ol>
<li>尝试自旋获取锁。</li>
<li>如果重试的次数达到了 MAX_SCAN_RETRIES 则改为阻塞锁获取，保证能获取成功。</li>
</ol>
<p>get逻辑<br>定位到Segment，然后找到HashEntry的value，value被volatile修饰</p>
<p>1.7的问题  基本上还是数组加链表的方式，去查询的时候，还得遍历链表，会导致效率很低</p>
<p>jdk1.8，采用了 CAS + synchronized 来保证并发安全性。<br>之前的HashEntry改成了Node，作用不变，值和next采用了volatile去修饰，保证了可见性，并且也引入了红黑树</p>
<p>ConcurrentHashMap在进行put操作的还是比较复杂的，大致可以分为以下步骤：</p>
<ol>
<li>根据 key 计算出 hashcode。</li>
<li>判断是否需要进行初始化。</li>
<li>即为当前 key 定位出的 Node，如果为空表示当前位置可以写入数据，利用 CAS 尝试写入，失败则自旋保证成功。</li>
<li>如果当前位置的 hashcode == MOVED == -1,则需要进行扩容。</li>
<li>如果都不满足，则利用 synchronized 锁写入数据。</li>
<li>如果数量大于 TREEIFY_THRESHOLD 则要转换为红黑树。</li>
</ol>
<p>CAS 是乐观锁的一种实现方式，是一种轻量级锁，JUC 中很多工具类的实现就是基于 CAS 的。</p>
<p>CAS 操作的流程如下图所示，线程在读取数据时不进行加锁，在准备写回数据时，比较原值是否修改，若未被其他线程修改则写回，若已被修改，则重新执行读取流程</p>
<p>CAS会有ABA问题，比如一个变量从A改到B再改回A，CAS可能无法得知变量是否有过变化，解决方法是加时间戳或者版本号</p>
<p>1.8的synchronized<br>无锁 -&gt; 偏向锁 -&gt; 轻量级锁（CAS） -&gt; 重量级锁</p>
<p>ConcurrentHashMap的get</p>
<p>根据计算出来的 hashcode 寻址，如果就在桶上那么直接返回值。<br>如果是红黑树那就按照树的方式获取值。<br>就不满足那就按照链表的方式遍历获取值。</p>
<h3 id="冷门的HashTable"><a href="#冷门的HashTable" class="headerlink" title="冷门的HashTable"></a>冷门的HashTable</h3><p>Collections.synchronizedMap怎么实现线程安全<br>在SynchronizedMap内部维护了一个普通对象Map，还有排斥锁mutex<br>在对实例化对象进行操作时，会去方法上锁</p>
<p>跟HashMap相比Hashtable是线程安全的，适合在多线程的情况下使用，但是效率可不太乐观。</p>
<p>HashTable使用synchronized关键字对方法上锁</p>
<p>Hashtable 是不允许键或值为 null 的，HashMap 的键值则都可以为 null，因为Hashtable在我们put 空值的时候会直接抛空指针异常，但是HashMap却做了特殊处理。Hashtable使用的是安全失败机制（fail-safe），这种机制会使此次读到的数据不一定是最新的数据。如果使用null值，就会使得其无法判断对应的key是不存在还是为空，因为无法再调用一次contain(key）来对key是否存在进行判断，ConcurrentHashMap同理。</p>
<p>hashtable和hashmap的不同点总结</p>
<p>实现方式不同：Hashtable 继承了 Dictionary类，而 HashMap 继承的是 AbstractMap 类。Dictionary 是 JDK 1.0 添加的，貌似没人用过这个，我也没用过。</p>
<p>初始化容量不同：HashMap 的初始容量为：16，Hashtable 初始容量为：11，两者的负载因子默认都是：0.75。</p>
<p>扩容机制不同：当现有容量大于总容量 * 负载因子时，HashMap 扩容规则为当前容量翻倍，Hashtable 扩容规则为当前容量翻倍 + 1。</p>
<p>迭代器不同：HashMap 中的 Iterator 迭代器是 fail-fast 的，而 Hashtable 的 Enumerator 不是 fail-fast 的。</p>
<p>引申fail-fast机制：快速失败（fail—fast）是java集合中的一种机制， 在用迭代器遍历一个集合对象时，如果遍历过程中对集合对象的内容进行了修改（增加、删除、修改），则会抛出Concurrent Modification Exception。迭代器在遍历时直接访问集合中的内容，并且在遍历过程中使用一个 modCount 变量。集合在被遍历期间如果内容发生变化，就会改变modCount的值。每当迭代器使用hashNext()/next()遍历下一个元素之前，都会检测modCount变量是否为expectedmodCount值，是的话就返回遍历；否则抛出异常，终止遍历。（意为遍历时无法修改）</p>
<p>java.util包下的集合类都是快速失败的，不能在多线程下发生并发修改（迭代过程中被修改）算是一种安全机制吧。安全失败（fail—safe）：java.util.concurrent包下的容器都是安全失败，可以在多线程下并发使用，并发修改。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/30/geojson使用geotools读取多类型geometry/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frodle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/30/geojson使用geotools读取多类型geometry/" itemprop="url">FeatureCollection读取多类型geometry</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-30T19:03:31+08:00">
                2019-10-30
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/30/geojson使用geotools读取多类型geometry/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/10/30/geojson使用geotools读取多类型geometry/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Geotools中的FeatureCollection支持多类型的Geometry"><a href="#Geotools中的FeatureCollection支持多类型的Geometry" class="headerlink" title="Geotools中的FeatureCollection支持多类型的Geometry"></a>Geotools中的FeatureCollection支持多类型的Geometry</h3><p><strong>原读取geojson数据并写入PostGis的逻辑</strong></p>
<p><img src="/2019/10/30/geojson使用geotools读取多类型geometry/image-20191030131734245.png" alt="image-20191030131734245"></p>
<p><strong>原逻辑不支持多类型Geometry的原因</strong></p>
<p>SimpleFeatureTypeBuilder维护了每一个feature中的属性和状态，Geotools文档（<a href="http://docs.geotools.org/stable/javadocs/org/geotools/feature/simple/SimpleFeatureTypeBuilder.html）中有描述" target="_blank" rel="noopener">http://docs.geotools.org/stable/javadocs/org/geotools/feature/simple/SimpleFeatureTypeBuilder.html）中有描述</a></p>
<p>A default geometry for the feature type can be specified explictly via <a href="http://docs.geotools.org/stable/javadocs/org/geotools/feature/simple/SimpleFeatureTypeBuilder.html#setDefaultGeometry-java.lang.String-" target="_blank" rel="noopener"><code>setDefaultGeometry(String)</code></a>. However if one is not set the first geometric attribute (<a href="http://docs.geotools.org/stable/javadocs/org/opengis/feature/type/GeometryType.html" target="_blank" rel="noopener"><code>GeometryType</code></a>) added will be resulting default. So if only specifying a single geometry for the type there is no need to call the method. However if specifying multiple geometries then it is good practice to specify the name of the default geometry type.</p>
<p>如果没有指定feature-type的geometry类型，则会取第一个feature的类型作为整个collection的geometry类型，其他类型则会被转换。因此代码里面判断geometry是点线面类型并不能生效，而且PostGis做数据源时，单表只能表示一个图层，如果要拆分点线面图层，则需要对应多个PostGis表，这就需要对collection中的featrue做拆分</p>
<p><strong>实现方案</strong></p>
<p>官方文档中给出的支持不同类型的geometry实质上是通过制定多个类型的properties来实现的，然而我们想要的是能不能把默认geometry的property支持不同类型的对象，SimpleFeatureTypeBuilder中的setDefaultGeometry可以修改默认的geometry属性，而add可以添加新的属性，remove可以删除已有属性，所以这里猜想可以通过先remove再add属性的方式，来修改一个字段的类型，然后最后设置geometry的属性字段，因为所有的geometry类型的对象类都继承自org.locationtech.jts.geom.Geometry这个抽象类，我们把默认的geometry属性的类型修改为这个抽象类的类型，就可以避免自动转换，然后再区分出点线面后，拆分出三个FeatureCollection来分别创建PostGis表，达到拆分图层的目的</p>
<p><img src="/2019/10/30/geojson使用geotools读取多类型geometry/image-20191030142404119.png" alt="image-20191030142404119"></p>
<p>最终写入PostGis的表</p>
<p><img src="/2019/10/30/geojson使用geotools读取多类型geometry/image-20191030142731337.png" alt="image-20191030142731337"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/29/postgis建表问题/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frodle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/29/postgis建表问题/" itemprop="url">记一次GIS数据上传到PostGis的问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-29T15:39:59+08:00">
                2019-10-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/29/postgis建表问题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/10/29/postgis建表问题/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="记录一次GIS上传报错问题排查"><a href="#记录一次GIS上传报错问题排查" class="headerlink" title="记录一次GIS上传报错问题排查"></a>记录一次GIS上传报错问题排查</h3><h5 id="现象：上传卡在了PostGis建完表写数据时，会报表找不到，然后报错，实际建表时并没有报错"><a href="#现象：上传卡在了PostGis建完表写数据时，会报表找不到，然后报错，实际建表时并没有报错" class="headerlink" title="现象：上传卡在了PostGis建完表写数据时，会报表找不到，然后报错，实际建表时并没有报错"></a>现象：上传卡在了PostGis建完表写数据时，会报表找不到，然后报错，实际建表时并没有报错</h5><p><strong>初步排查</strong>：通过报不存在的表名gisp_upload_c4a95ec8e8452135eb5a5ba7e6487585_1572330097034_5411_polygon去查PostGis发现确实没有这个表，但是查到了gisp_upload_c4a95ec8e8452135eb5a5ba7e6487585_1572330097034_5411这张表，而对应名称是没有改多图层上面之前的命名规则（新的规则在表名后面加了_图层类型），于是怀疑业务逻辑中可能哪里没有改全，于是开始debug上传的业务代码</p>
<p><img src="/2019/10/29/postgis建表问题/image-20191029151727889.png" alt="image-20191029151727889"></p>
<p><img src="/2019/10/29/postgis建表问题/image-20191029151850991.png" alt="image-20191029151850991"></p>
<p><img src="/2019/10/29/postgis建表问题/image-20191029151937843.png" alt="image-20191029151937843"></p>
<p>debug到了建表SQL，发现并没有问题，继续往下走，等execute完直接查库</p>
<p><img src="/2019/10/29/postgis建表问题/image-20191029152157183.png" alt="image-20191029152157183"></p>
<p>建表的SQL对了，但是表名确实不对，于是复制建表SQL在客户端直接执行</p>
<p><img src="/2019/10/29/postgis建表问题/image-20191029152728163.png" alt="image-20191029152728163"></p>
<p>发现是Postgre把表名给改了….问题找到了</p>
<p><strong>定位并解决</strong></p>
<p>PostgreSQL 表名有限制，长度为NAMEDATALEN（一般为64）</p>
<p>The system uses no more than NAMEDATALEN-1 characters of an identifier; longer names can be written in commands, but they will be truncated. By default, NAMEDATALEN is 64 so the maximum identifier length is 63 (but at the time PostgreSQL is built, NAMEDATALEN can be changed in src/include/postgres_ext.h).</p>
<p>From <a href="https://www.postgresql.org/docs/7.3/sql-syntax.html" target="_blank" rel="noopener">https://www.postgresql.org/docs/7.3/sql-syntax.html</a></p>
<p><strong>注意执行SQL时，Postgre不会报错！！！但是会报出Notice，然后执行truncated后的SQL</strong><br>NOTICE:  identifier “gisp_upload_c4a95ec8e8452135eb5a5ba7e6487585_1572330097034_5411_polygon” will be truncated to “gisp_upload_c4a95ec8e8452135eb5a5ba7e6487585_1572330097034_5411”</p>
<p>旧的表命名规则：gisp_upload_32位用户id_13位时间戳_4位随机数，总位数刚好是63（64-1长度）…..新的规则又在基础上加了6~12位不等，超过了最大长度会只保留到最大长度位</p>
<p>最终修改命名规则：</p>
<p>gisp_upload_16位用户id_10位时间戳_4位随机数_10位内的点线面标识，最大长度55位</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/06/tornado接收参数只是string/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frodle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/06/tornado接收参数只是string/" itemprop="url">请求参数不支持数值</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-06T15:10:31+08:00">
                2019-09-06
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/06/tornado接收参数只是string/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/09/06/tornado接收参数只是string/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Tornado剖析"><a href="#Tornado剖析" class="headerlink" title="Tornado剖析"></a>Tornado剖析</h2><h4 id="Q-为什么解析的参数格式只有string，而无法区分出int"><a href="#Q-为什么解析的参数格式只有string，而无法区分出int" class="headerlink" title="Q: 为什么解析的参数格式只有string，而无法区分出int"></a>Q: 为什么解析的参数格式只有string，而无法区分出int</h4><p>背景：前端传参通过form，fe转发需要把form表单转成raw_body的json字符串，转发给gis的后端服务，gis后端服务里面报错发现fe转发中的传参中，数字和字符都是字符串，而kotlin类型无法string转interger所以报错，这里调研了一下能否看框架参数能否支持到默认转发时保留不同类型</p>
<p>类tornado.web.RequestHandler维持了request变量（tornado.httputil.HTTPServerRequest类）<br>这个request变量中维护了arguments、body_arguments以及body三个属性，前两个是格式化的参数字典结构，后一个从请求中直接读出来的body string</p>
<p>request对象的初始化在tornado.routing._RoutingDelegate类中进行实例化，这里有个比较有趣的点，实例化request的方法是_RoutingDelegate.headers_received，而调度headers_received的模式实际上用yield关键字生成Future，使tornado.gen.Runner这个类异步调用了tornado.http1util.HTTP1Connection中方法_read_message，而tornado.gen.Runner是tornado中异步处理的核心类，同时也是Future对象的执行类，通过执行generator的send方法不断异步执行，最后set_result返回Future，这个设涉及到的就是tornado.gen模块如何异步切换请求上下文以及执行Future对象</p>
<p>_RoutingDelegate类中会对应使用data_received方法把body中的字节数据放入request结构中，依然是异步调度到Runner后，Runner在执行过程中调度tornado.http1util.HTTP1Connection的_read_fixed_body方法，读取数据就是直接对应到Request类的body属性中，类似于URL中的form格式存储</p>
<p>这里顺便提一下读取Header和Body的过程，Tornado使用tornado.iostream.IOStream处理套接字和IO操作，这个类实现非阻塞的socket读写操作，实现非阻塞依然是通过方法返回Future对象，然后ioloop到Runner中最后执行，这里不再详细解释具体每个不同的方法的特征和作用</p>
<p>通过IOStream非阻塞读取，最后回调_RoutingDelegate的data_received，写入body后再执行_RoutingDelegate的finish，更新request的arguments、body_arguments，真正的执行过程中，还涉及到_HandlerDelegate这个类，其实在整个请求的生命周期中，tornado会根据不同的阶段生成不同的Delegate类去处理，_RoutingDelegate是路由派发的实例化入口，也是异步调度的实例化入口，_RoutingDelegate会调度_HandlerDelegate这个类，去做真正的request的改动，最后处理到业务级别RequestHandler，所以实质上是_HandlerDelegate去修改request中的属性，在finish中，调用request的_parse_body方法，最终调用到parse_qsl这个方法，这个方法是用标准格式去切分body字符的，所以split出来的最终都是string格式，无法解析出int</p>
<p>在debug过程中，实际发现tornado在调度_RoutingDelegate和IOStream做IO时都会使用yield异步调度Future对象，最后set_result以及callback，也就是异步框架的体现</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/06/hello-world/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frodle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/06/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-06T15:03:40+08:00">
                2019-09-06
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/06/hello-world/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/09/06/hello-world/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/29/problem-0522/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frodle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/29/problem-0522/" itemprop="url">记录一次需求开发的坑（表格列总计新增计算方式）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-29T11:49:03+08:00">
                2019-05-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/29/problem-0522/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/05/29/problem-0522/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>开发两个自定义聚合函数 MAX_TO_VALUE OR MIN_TO_VALUE</p>
<h2 id="Problem-1-UDAF依赖class不对的问题"><a href="#Problem-1-UDAF依赖class不对的问题" class="headerlink" title="Problem 1: UDAF依赖class不对的问题"></a>Problem 1: UDAF依赖class不对的问题</h2><p>开发完成联调时发现执行SQL时，旧函数BOL指向的Java class不对</p>
<h3 id="定位以及解决"><a href="#定位以及解决" class="headerlink" title="定位以及解决"></a>定位以及解决</h3><p>Scala的Server程序会在启动时注册一遍所有UDF和UDAF，对于已经create过的函数将不会重复register，而开发中，发现BOL这个之前的函数对应的class命名不规范，修改了之前的class类名，而增加的MAX_TO_VALUE对应的class则用了之前函数的class，初始化时，BOL已经被创建了，指向的class不变，而由于实际上class名称已经被修改，所以出现了指向错误问题。</p>
<p>解决: 在Hive中删除之前已注册过的函数，重启Server，重新注册UDF后解决</p>
<h2 id="Problem-2-新增UDAF运行结果一直为Null"><a href="#Problem-2-新增UDAF运行结果一直为Null" class="headerlink" title="Problem 2: 新增UDAF运行结果一直为Null"></a>Problem 2: 新增UDAF运行结果一直为Null</h2><p>PostMan模拟请求时，MAX_TO_VALUE结果一直是空</p>
<h3 id="定位以及解决-1"><a href="#定位以及解决-1" class="headerlink" title="定位以及解决"></a>定位以及解决</h3><p>Debug模式运行Server，断点调试发现UDAF在iterate和terminatePartial完成后，merge的时候传入的数据结构SimpleNormalValue的outputVal一直是null，而在iterate阶段是确认有值的，后续跟踪断点发现terminatePartial-&gt;merge的过程中，hive使用了Java反射去传递SimpleNormalValue这个类的结构，而SimpleNormalValue是从SimpleValue继承过来的，父类中的protected类型的变量outputVal对于子类是private类型，反射是获取不到private的变量</p>
<p>解决: 声明从protected变为public，或者不继承outputVal而是重新声明子类的outputVal</p>
<h2 id="Problem-3-含对比时计算结果不对"><a href="#Problem-3-含对比时计算结果不对" class="headerlink" title="Problem 3: 含对比时计算结果不对"></a>Problem 3: 含对比时计算结果不对</h2><p>有对比维度时，表格统计的值预期是(3,null,null)，实际为(3,3,3)</p>
<h3 id="定位以及解决-2"><a href="#定位以及解决-2" class="headerlink" title="定位以及解决"></a>定位以及解决</h3><p>包含对比时，查询的原始表的维度中包含了对比维度，另外结果集是用临时表做if判断然后再聚合的结果，因此实际表数据中没有的空记录，会被展示到查询结果里面，而列总计统计的是原始表的数据，而非结果数据或临时表数据（因为要统计limit之前的数据），另外对原始数据的维度idx计算也不准确</p>
<p>解决: 修复原始数据维度idx偏移的问题</p>
<p>TODO: 后续把包含对比列总计的逻辑，从直接对原始表进行GROUP SET分类聚合，改造为对对比拆分后的临时表进行GROUP SET分类聚合，改造工作大致有几点：1.临时表的维度不包含对比，因此GROUP SET需要包含空，且一个数值要根据xy_fields结构拆分成多列，同理在处理列总计查询到的数据时，之前的分类聚合是对不同对比做拆分的，而后续结果是要根据数值idx在拆分; 2.包含TOP的时候是Join了结果表和原始表，需要改造为Join结果表和临时表; 3.包含高级计算（同环比）时，注意兼容之前为了处理高级计算列总计的相关开发</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/02/gdb调试运行中进程/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frodle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/02/gdb调试运行中进程/" itemprop="url">gdb调试运行中进程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-02T16:57:24+08:00">
                2019-03-02
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/02/gdb调试运行中进程/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/03/02/gdb调试运行中进程/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>安装Python调试环境: <a href="https://wiki.python.org/moin/DebuggingWithGdb" target="_blank" rel="noopener">https://wiki.python.org/moin/DebuggingWithGdb</a></p>
</blockquote>
<h2 id="常用GDB命令"><a href="#常用GDB命令" class="headerlink" title="常用GDB命令"></a>常用GDB命令</h2><ol>
<li>gdb原生命令<ol>
<li><code>bt</code> 显示当前线程C部分调用栈</li>
<li><code>list</code> 示当前线程的C代码执行位置</li>
<li><code>info threads</code> 显示当前进程中的所有线程</li>
<li><code>thread apply {ID} {command}</code> 在线程{ID}上执行命令, 默认命令在1号线程执行</li>
<li><code>print</code> 打印C变量值</li>
<li><code>up</code> 返回C部分调用者</li>
<li><code>down</code> 进入C部分函数调用</li>
</ol>
</li>
<li>Python扩展命令 <ol>
<li><code>py-bt</code> 显示当前线程Python部分调用栈</li>
<li><code>py-list</code> 显示当前线程的Python代码执行位置</li>
<li><code>py-locals</code> 获取当前局部变量的值</li>
<li><code>py-print</code> 打印某个变量的值</li>
<li><code>py-up</code> 返回Python部分调用者</li>
<li><code>py-down</code> 进入Python部分函数调用</li>
</ol>
</li>
</ol>
<h2 id="常用Linux命令"><a href="#常用Linux命令" class="headerlink" title="常用Linux命令"></a>常用Linux命令</h2><ol>
<li><code>strace -p {PID}</code> 跟踪指定进程的系统调用情况</li>
<li><code>lslocks</code> 列出当前系统中的文件锁情况</li>
<li><code>fuser {file}</code> 列出打开该文件的进程ID</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">frodle</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">frodle</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://tianhaotian.disqus.com/count.js" async></script>
    

    

  




	





  












  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'HG7On1dDpIgn5bjeqMqzSqx7-gzGzoHsz',
        appKey: 'GDRbP4lxFrqUQJUXq53cDnOt',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

</body>
</html>
